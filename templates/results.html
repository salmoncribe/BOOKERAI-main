{% extends "layout.html" %}
{% block title %}Search Results â€” BookerAI{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}?v={{ asset_ver }}">
{% endblock %}

{% block content %}
<section class="results-page vibrant-auth">
  <div class="animated-bg"></div>

  <div class="wow-card results-header">
    <h2 class="auth-title">Professionals Near You ğŸ’ˆ</h2>

    {% if barbers %}
    <p class="muted">
      Showing <strong>{{ barbers|length }}</strong> professionals
      {% if city %} in <strong>{{ city|title }}</strong>{% endif %}
      {% if service %} specializing in <strong>{{ service|title }}</strong>{% endif %}.
    </p>
    {% else %}
    <p class="muted">
      No professionals found matching your search. Try another service or nearby city.
    </p>
    {% endif %}
  </div>

  {% if barbers %}
  <div class="results-grid">
    {% for b in barbers %}
    <div class="pro-card" style="position:relative;">
      {# ğŸ–¼ï¸ Media Gallery Preview #}
      {% set media_str = b.media_urls or b.media_url or '' %}
      {% set media_list = media_str.split(',') if media_str else [] %}

      {% if media_list %}
      <div class="pro-media">
        {% for m in media_list[:3] %}
        {% set url = m.strip() %}
        {% if url.endswith(('.mp4', '.mov', '.webm', '.m4v')) %}
        <video src="{{ url }}" class="media-thumb" muted loop autoplay playsinline>
        </video>
        {% else %}
        <img src="{{ url }}" alt="{{ b.name }} work" class="media-thumb">
        {% endif %}
        {% endfor %}
      </div>
      {% else %}
      <div class="pro-placeholder">
        <span>No media yet</span>
      </div>
      {% endif %}

      {# ğŸ‘¤ Info Section #}
      <div class="pro-info" style="display:flex; gap:1rem; align-items:start; margin-top:1rem;">

        <!-- Profile Photo -->
        <div class="pro-avatar" style="flex-shrink:0;">
          {% if b.photo_url %}
          <img src="{{ b.photo_url }}" alt="{{ b.name }}"
            style="width:50px; height:50px; border-radius:50%; object-fit:cover; border:2px solid var(--primary);">
          {% else %}
          <div style="width:50px; height:50px; border-radius:50%; background:linear-gradient(135deg, #cbd5e1, #94a3b8);
             display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold;">
            {{ (b.name or 'B')[:1] | upper }}
          </div>
          {% endif %}
        </div>

        <div>
          <h3 class="pro-name" style="margin:0; display:flex; align-items:center; gap:0.5rem;">
            {{ b.name }}
            {% if b.plan == 'premium' %}
            <span title="Premium Professional"
              style="font-size:0.8rem; background:linear-gradient(135deg,#facc15,#eab308); color:#fff; padding:2px 6px; border-radius:99px;">â˜…</span>
            {% endif %}
          </h3>
          <p class="muted small" style="margin:0.25rem 0;">{{ b.profession or "Independent Professional" }}</p>
          <p class="pro-location" style="font-size:0.85rem; color:var(--text-light);">
            ğŸ“ {{ b.location or b.address or "Location not set" }}
          </p>
        </div>
      </div>

      {# ğŸ”— CTA â†’ public booking page /b/<id> #}
        <a href="{{ url_for('book_view', barber_id=b.barberId) }}" class="btn-primary gradient-btn view-btn">
          View Profile
        </a>

    </div>
    {% endfor %}
  </div>
  {% endif %}
</section>
{% endblock %}