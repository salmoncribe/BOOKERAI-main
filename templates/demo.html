{% extends "layout.html" %}
{% block title %}Preview â€” BookerAI Premium{% endblock %}

{% block content %}
<!-- Replicating Dashboard.html Premium Theme exactly -->
<section class="dashboard vibrant-auth premium-theme" id="dashboardRoot">

  <div class="animated-bg"></div>

  <!-- Header Section -->
  <div class="dash-head">
    <div class="premium-bubble" title="Premium Active"></div>

    <div style="display:flex;align-items:center;gap:1rem;">
      <!-- Avatar (Static for Demo) -->
      <div style="width:60px;height:60px;border-radius:50%;overflow:hidden;flex-shrink:0;position:relative;">
        <!-- Using Unsplash for realistic demo avatar -->
        <img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=150&h=150"
          alt="Alexander" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
        <div style="position:absolute;bottom:0;right:0;width:22px;height:22px;
                      background:linear-gradient(135deg,var(--sky-blue),var(--teal));
                      border-radius:50%;display:flex;align-items:center;justify-content:center;
                      color:#fff;font-size:0.75rem;">
          ðŸ“·
        </div>
      </div>

      <!-- Text -->
      <div>
        <h1 class="dash-title">
          Welcome, Alexander
        </h1>
        <p class="muted small">Manage your hours and appointments below.</p>
      </div>
    </div>

    <!-- Header Actions -->
    <div class="dash-head-actions" style="margin-left:auto; display:flex; gap:0.75rem;">
      <button class="nav-action-btn desktop-dash-btn" onclick="alert('This would download your report!')"
        style="color:var(--text-premium); background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);">
        <i data-lucide="download" style="width:16px;height:16px;"></i> Reports
      </button>
      <button class="nav-action-btn desktop-dash-btn" onclick="alert('This would open your settings!')"
        style="color:var(--text-premium); background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);">
        <i data-lucide="settings" style="width:16px;height:16px;"></i> Settings
      </button>
    </div>
  </div>

  <div class="dashboard-grid">
    <!-- Main Content -->
    <div class="main-content">
      <!-- Upcoming Appointments -->
      <div class="card appointments-card">
        <div class="appt-header"
          style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
          <h3>Upcoming Appointments</h3>
          <button class="btn btn-secondary small" onclick="openDemoCalendar()">View Calendar</button>
        </div>

        <div class="table-scroll">
          <table class="table">
            <thead>
              <tr>
                <th>Client</th>
                <th>Phone</th>
                <th>When</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-label="Client">Michael Rossi</td>
                <td data-label="Phone">
                  <a href="#">555-0123</a>
                </td>
                <td data-label="When" style="font-weight:600; color:var(--sky-blue);">Today 9:00 AM</td>
              </tr>
              <tr>
                <td data-label="Client">David Chen</td>
                <td data-label="Phone">
                  <a href="#">555-0198</a>
                </td>
                <td data-label="When">Today 10:15 AM</td>
              </tr>
              <tr>
                <td data-label="Client">Sarah Williams</td>
                <td data-label="Phone">
                  <a href="#">555-2468</a>
                </td>
                <td data-label="When">Tomorrow 2:00 PM</td>
              </tr>
              <tr>
                <td data-label="Client">Marcus Johnson</td>
                <td data-label="Phone">
                  <a href="#">555-3344</a>
                </td>
                <td data-label="When">Fri Oct 24 11:30 AM</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- No bottom button - Removed as per premium guidelines -->
      </div>

      <!-- Business Hours -->
      <div class="card hours-card">
        <div class="hours-header" style="flex-direction:column; gap:0.5rem; margin-bottom:1rem;">
          <h3>Business Hours</h3>
          <p class="muted small" style="margin:0;">
            Set your availability so clients can book you online.
          </p>
        </div>

        <div style="text-align:center; margin-bottom:1rem;">
          <button class="btn btn-secondary small" onclick="alert('Hours editor is interactive in the full version!')">
            Edit Hours
          </button>
        </div>

        <!-- Static Hours List for Demo -->
        <div class="hours-list">
          <!-- Mon - Fri -->
          {% for d in ["Mon", "Tue", "Wed", "Thu", "Fri"] %}
          <div class="hours-row" style="opacity: 1;">
            <div class="day-label">{{ d }}</div>
            <div class="day-actions">
              <label class="toggle-switch">
                <input type="checkbox" checked disabled>
                <span class="slider"></span>
              </label>
              <div class="time-range">
                <span style="font-size:0.9rem; font-weight:600; color:var(--text-premium);">09:00 to 17:00</span>
              </div>
              <div class="save-check" style="opacity:0">âœ…</div>
            </div>
          </div>
          {% endfor %}
          <!-- Weekends Closed -->
          {% for d in ["Sat", "Sun"] %}
          <div class="hours-row closed" style="opacity: 1;">
            <div class="day-label">{{ d }}</div>
            <div class="day-actions">
              <label class="toggle-switch">
                <input type="checkbox" disabled>
                <span class="slider"></span>
              </label>
              <div class="time-range" style="opacity:0.5">
                <span style="font-size:0.9rem; font-weight:600;">09:00 to 17:00</span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar-sticky">

      <!-- Media Upload Section (Mock) -->
      <div class="card media-card">
        <h3>Profile Photos & Videos</h3>
        <p class="muted small">Show off your work â€” upload photos or videos directly to your profile gallery.</p>
        <div style="margin-top:1rem;">
          <button type="button" class="gradient-btn small" style="width:100%;"
            onclick="alert('File upload available in full version!')">
            ðŸ“¤ Upload File
          </button>
        </div>
        <div class="media-gallery" style="margin-top:1rem;display:flex;flex-wrap:wrap;gap:0.75rem;">
          <!-- Mock Gallery -->
          <img src="https://images.unsplash.com/photo-1585747860715-2ba37e788b70?auto=format&fit=crop&w=100&h=100"
            style="width:30%; aspect-ratio:1; object-fit:cover; border-radius:8px;">
          <img src="https://images.unsplash.com/photo-1621605815971-fbc98d665033?auto=format&fit=crop&w=100&h=100"
            style="width:30%; aspect-ratio:1; object-fit:cover; border-radius:8px;">
          <img src="https://images.unsplash.com/photo-1503951914875-befbb7135952?auto=format&fit=crop&w=100&h=100"
            style="width:30%; aspect-ratio:1; object-fit:cover; border-radius:8px;">
        </div>
      </div>

      <!-- Promo Card (Mock) -->
      <div class="card promo-card">
        <h3>Your Promo Code</h3>
        <p class="muted small">
          Share this â€” when someone upgrades, you both get a free month.
        </p>
        <div style="display:flex;gap:0.5rem;align-items:center;margin-top:1rem;">
          <input type="text" value="ALEX2025" readonly
            style="width:100%;padding:0.5rem;border-radius:0.5rem;border:1px solid #ccc; background: rgba(255,255,255,0.1); color:white;">
          <button type="button" class="copy-btn-modern" onclick="alert('Copied!')">
            <span>Copy</span>
          </button>
        </div>
      </div>

      <!-- Sticky CTA -->
      <div class="card"
        style="background:linear-gradient(135deg,#fbbf24,#d97706); border:none; color:white; text-align:center;">
        <h3 style="color:white; margin-bottom:0.5rem;">Start Your Free Trial</h3>
        <p style="font-size:0.9rem; opacity:0.9; margin-bottom:1rem;">Like what you see? Get your own premium dashboard
          today.</p>
        <a href="{{ url_for('signup') }}" class="btn"
          style="background:white; color:#d97706; border:none; font-weight:700; display:block; padding:0.8rem;">Create
          Account</a>
      </div>

    </aside>
  </div>

  <!-- Calendar Modal -->
  <div id="calendarModal" class="calendar-modal">
    <div class="calendar-content">
      <div class="calendar-header">
        <h2>Schedule</h2>
        <button class="close-modal-btn" onclick="closeCalendar()">Ã—</button>
      </div>
      <div id="calendarGrid" class="cal-grid">
        <!-- JS will populate -->
      </div>
      <!-- Detail Panel -->
      <div id="calendarDetails" class="cal-details-panel">
        <p class="muted small text-center" style="margin-top:1rem;">Select a day to view appointments</p>
      </div>
    </div>
  </div>

</section>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/lucide@latest"></script>
<!-- Include base dashboard js for toggle logic, but we will override calendar -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<script>
  // Mock Data for Demo Calendar
  const DEMO_APPOINTMENTS = [
    { date: new Date().toISOString().split('T')[0], start_time: "09:00", client_name: "Michael Rossi", service: "Fade & Beard", status: "confirmed" },
    { date: new Date().toISOString().split('T')[0], start_time: "10:15", client_name: "David Chen", service: "Classic Cut", status: "confirmed" },
    { date: new Date(Date.now() + 86400000).toISOString().split('T')[0], start_time: "14:00", client_name: "Sarah Williams", service: "Color", status: "booked" },
  ];

  window.openDemoCalendar = function () {
    const modal = document.getElementById("calendarModal");
    if (modal) {
      modal.classList.add("active");
      renderDemoCalendar();
    }
  }

  window.closeCalendar = function () {
    const modal = document.getElementById("calendarModal");
    if (modal) modal.classList.remove("active");
    const details = document.getElementById("calendarDetails");
    if (details) details.innerHTML = '<p class="muted small text-center" style="margin-top:1rem;">Select a day to view appointments</p>';
  }

  function renderDemoCalendar() {
    const grid = document.getElementById("calendarGrid");
    if (!grid) return;
    grid.innerHTML = "";

    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const firstDay = new Date(year, month, 1).getDay();

    const days = ["S", "M", "T", "W", "T", "F", "S"];
    days.forEach(d => {
      const el = document.createElement("div");
      el.className = "cal-day-name";
      el.textContent = d;
      grid.appendChild(el);
    });

    for (let i = 0; i < firstDay; i++) {
      const el = document.createElement("div");
      el.className = "cal-day empty";
      grid.appendChild(el);
    }

    const today = now.getDate();
    for (let i = 1; i <= daysInMonth; i++) {
      const el = document.createElement("div");
      el.className = "cal-day";
      if (i === today) el.classList.add("today");

      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
      const dayAppts = DEMO_APPOINTMENTS.filter(a => a.date === dateStr);

      if (dayAppts.length > 0) {
        el.classList.add("has-event");
        const dot = document.createElement("div");
        dot.className = "cal-dot";
        el.appendChild(dot);
      }

      el.textContent = i;
      el.onclick = () => {
        document.querySelectorAll(".cal-day").forEach(c => c.classList.remove("selected"));
        el.classList.add("selected");
        renderDemoDetails(dateStr, dayAppts);
      };
      grid.appendChild(el);
    }
  }

  function renderDemoDetails(dateStr, appts) {
    const panel = document.getElementById("calendarDetails");
    if (!panel) return;
    panel.innerHTML = "";

    const dateHeader = document.createElement("h4");
    dateHeader.className = "cal-details-header";
    const dateObj = new Date(dateStr + "T12:00:00");
    dateHeader.textContent = dateObj.toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
    panel.appendChild(dateHeader);

    if (appts.length === 0) {
      const emptyState = document.createElement("div");
      emptyState.className = "cal-empty-state";
      emptyState.innerHTML = `<p>No appointments yet for this day ðŸ˜Š</p>`;
      panel.appendChild(emptyState);
      return;
    }

    const list = document.createElement("div");
    list.className = "cal-appt-list";

    appts.forEach(a => {
      const item = document.createElement("div");
      item.className = "cal-appt-item";
      item.innerHTML = `
            <div class="cal-appt-time">${a.start_time}</div>
            <div class="cal-appt-info">
            <div class="cal-client-name">${a.client_name}</div>
            <div class="cal-service">${a.service}</div>
            </div>
            <div class="cal-appt-status status-${a.status}">${a.status}</div>
        `;
      list.appendChild(item);
    });
    panel.appendChild(list);
  }
</script>
{% endblock %}