{% set public_link = url_for('book_view', barber_id=barber.id, _external=True) %}

<section class="dashboard" id="dashboardRoot" data-barber-id="{{ barber.id }}">

  <!-- Upgrade Banner -->
  <div class="upgrade-banner">
    Youâ€™re live on BookerAI ðŸš€  
    Unlock analytics, profile boosts, and automation with <strong>Premium</strong>.
    <a href="{{ url_for('demo') }}">See whatâ€™s possible</a>
  </div>

  <!-- Header -->
  <div class="dash-header-left">
    <div class="dash-avatar">
      {{ (barber.name or 'B')[:1] | upper }}
    </div>
    <div>
      <h1>
        Welcome{% if barber.name %}, {{ barber.name }}{% endif %}
      </h1>
      <p class="muted small">Free BookerAI Dashboard</p>
    </div>
  </div>

  <!-- Core Actions -->
  <div class="dash-actions">
    <button
      type="button"
      class="btn-primary gradient-btn small"
      data-copy="{{ public_link }}">
      Copy booking link
    </button>

    <a class="btn btn-secondary small"
       href="{{ public_link }}"
       target="_blank"
       rel="noopener">
      Open public page
    </a>

    {% if features.find_pro %}
      <a class="btn btn-secondary small"
         href="{{ url_for('find_pro_route') }}">
        Find a Pro
      </a>
    {% endif %}
  </div>

  <!-- Appointments -->
  <div class="wow-card">
    <h3>Upcoming Appointments</h3>

    {% if appointments %}
      <table class="table">
        <thead>
          <tr>
            <th>Client</th>
            <th>Phone</th>
            <th>When</th>
          </tr>
        </thead>
        <tbody>
          {% for a in appointments %}
            <tr>
              <td>{{ a.client_name or "Unknown" }}</td>
              <td>{{ a.client_phone or "â€”" }}</td>
              <td>{{ a.date }} {{ a.start_time }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted small">No upcoming appointments yet.</p>
    {% endif %}
  </div>

  <!-- Business Hours -->
  <div class="wow-card">
    <h3>Business Hours</h3>
    <p class="muted small">
      Set your availability so clients can book you online.
    </p>
    <button id="toggleHoursBtn" class="btn btn-secondary small">
      Edit Hours
    </button>
  </div>

  <!-- Profile Media (Locked for Free) -->
  <div class="wow-card">
    <h3>Profile Photos & Videos</h3>
    <p class="muted small">
      Premium profiles get more bookings and higher visibility.
    </p>

    {% if features.profile_media %}
      <button class="btn-primary small">Upload Media</button>
    {% else %}
      <a href="{{ url_for('subscribe') }}"
         class="btn btn-secondary small">
        Unlock Media Uploads ðŸ”’
      </a>
    {% endif %}
  </div>

  <!-- Promo Code -->
  <div class="wow-card">
    <h3>Your Promo Code</h3>
    <p class="muted small">
      Share this â€” when someone upgrades, you both get a free month.
    </p>

    <div style="display:flex;gap:0.5rem;align-items:center;">
      <input
        type="text"
        value="{{ barber.promo_code }}"
        readonly
        onclick="this.select()"
      />
      <button
        type="button"
        class="btn-primary small"
        onclick="navigator.clipboard.writeText('{{ barber.promo_code }}')">
        Copy
      </button>
    </div>
  </div>

  <!-- Upgrade CTA -->
  <div class="upgrade-card">
    <h3>Upgrade to Premium ðŸ’Ž</h3>
    <p>
      Get boosted in search, upload media, track earnings,
      and automate your bookings.
    </p>
    <a href="{{ url_for('subscribe') }}" class="upgrade-btn">
      Upgrade Now
    </a>
  </div>

</section>
